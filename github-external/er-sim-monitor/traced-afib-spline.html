<!DOCTYPE html>
<html>
<head>
  <title>AFib - Spline Interpolation vs Linear</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #000;
      font-family: monospace;
    }
    canvas {
      background: #000;
      display: block;
      margin: 20px auto;
      border: 1px solid #333;
    }
    .info {
      color: #0f0;
      text-align: center;
      margin: 10px 0;
      font-size: 16px;
      font-weight: bold;
    }
    .note {
      color: #ff0;
      text-align: center;
      margin: 5px 0;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="info">Linear Interpolation (Current Method - Choppy)</div>
  <canvas id="linear" width="1200" height="200"></canvas>

  <div class="info" style="margin-top: 40px;">Catmull-Rom Spline (Smooth Curves)</div>
  <div class="note">This creates natural smooth curves through the same traced points</div>
  <canvas id="spline" width="1200" height="200"></canvas>

  <script>
    const width = 1200;
    const height = 200;

    // Key traced points from ResusMonitor (simplified for demo)
    const keyPoints = [
      { x: 0.00, y: 0.00 },
      { x: 0.05, y: 0.03 },
      { x: 0.062, y: -0.05 }, // Q
      { x: 0.064, y: 0.95 },  // R peak
      { x: 0.066, y: -0.08 }, // S
      { x: 0.08, y: 0.02 },
      { x: 0.12, y: 0.05 },
      { x: 0.142, y: -0.05 },
      { x: 0.144, y: 0.95 },
      { x: 0.146, y: -0.08 },
      { x: 0.18, y: 0.05 },
      { x: 0.26, y: 0.06 },
      { x: 0.334, y: -0.05 },
      { x: 0.336, y: 0.95 },
      { x: 0.338, y: -0.08 },
      { x: 0.40, y: 0.05 },
      { x: 0.444, y: -0.05 },
      { x: 0.446, y: 0.95 },
      { x: 0.448, y: -0.08 },
      { x: 0.52, y: 0.06 },
      { x: 0.576, y: -0.05 },
      { x: 0.578, y: 0.95 },
      { x: 0.580, y: -0.08 },
      { x: 0.63, y: 0.05 },
      { x: 0.658, y: -0.05 },
      { x: 0.660, y: 0.95 },
      { x: 0.662, y: -0.08 },
      { x: 0.690, y: -0.05 },
      { x: 0.692, y: 0.95 },
      { x: 0.694, y: -0.08 },
      { x: 0.75, y: 0.05 },
      { x: 0.85, y: 0.05 },
      { x: 1.00, y: 0.03 },
    ];

    // Linear interpolation
    function linearInterpolate(x) {
      const xNorm = x / width;
      let i = 0;
      while (i < keyPoints.length - 1 && keyPoints[i + 1].x < xNorm) {
        i++;
      }
      if (i >= keyPoints.length - 1) return keyPoints[keyPoints.length - 1].y;

      const p1 = keyPoints[i];
      const p2 = keyPoints[i + 1];
      const t = (xNorm - p1.x) / (p2.x - p1.x);
      return p1.y + (p2.y - p1.y) * t;
    }

    // Catmull-Rom spline interpolation (smooth curves through points)
    function catmullRom(p0, p1, p2, p3, t) {
      return 0.5 * (
        2 * p1 +
        (-p0 + p2) * t +
        (2 * p0 - 5 * p1 + 4 * p2 - p3) * t * t +
        (-p0 + 3 * p1 - 3 * p2 + p3) * t * t * t
      );
    }

    function splineInterpolate(x) {
      const xNorm = x / width;

      // Find segment
      let i = 0;
      while (i < keyPoints.length - 1 && keyPoints[i + 1].x < xNorm) {
        i++;
      }
      if (i >= keyPoints.length - 1) return keyPoints[keyPoints.length - 1].y;

      // Get 4 points for Catmull-Rom
      const p0 = i > 0 ? keyPoints[i - 1] : keyPoints[i];
      const p1 = keyPoints[i];
      const p2 = keyPoints[i + 1];
      const p3 = i < keyPoints.length - 2 ? keyPoints[i + 2] : keyPoints[i + 1];

      // Local t within this segment
      const t = (xNorm - p1.x) / (p2.x - p1.x);

      // Catmull-Rom interpolation
      return catmullRom(p0.y, p1.y, p2.y, p3.y, t);
    }

    // Draw linear version
    const linearCanvas = document.getElementById('linear');
    const linearCtx = linearCanvas.getContext('2d');
    linearCtx.strokeStyle = '#00ff00';
    linearCtx.lineWidth = 2;
    linearCtx.beginPath();
    for (let x = 0; x <= width; x++) {
      const y = height / 2 - linearInterpolate(x) * 70 * 1.5;
      if (x === 0) linearCtx.moveTo(x, y);
      else linearCtx.lineTo(x, y);
    }
    linearCtx.stroke();

    // Draw spline version
    const splineCanvas = document.getElementById('spline');
    const splineCtx = splineCanvas.getContext('2d');
    splineCtx.strokeStyle = '#00ff00';
    splineCtx.lineWidth = 2;
    splineCtx.beginPath();
    for (let x = 0; x <= width; x++) {
      const y = height / 2 - splineInterpolate(x) * 70 * 1.5;
      if (x === 0) splineCtx.moveTo(x, y);
      else splineCtx.lineTo(x, y);
    }
    splineCtx.stroke();

    // Mark key points on both
    [linearCtx, splineCtx].forEach(ctx => {
      ctx.fillStyle = '#f0f';
      keyPoints.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x * width, height / 2 - p.y * 70 * 1.5, 3, 0, Math.PI * 2);
        ctx.fill();
      });
    });
  </script>
</body>
</html>
