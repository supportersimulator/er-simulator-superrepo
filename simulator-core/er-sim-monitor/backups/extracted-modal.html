<!DOCTYPE html><html><head><meta charset="utf-8"><style>body { font-family: sans-serif; margin: 0; padding: 20px; }.log-panel { background: #1e1e1e; color: #d4d4d4; padding: 15px; height: 200px; overflow-y: auto; border-radius: 8px; margin-bottom: 20px; border: 3px solid #007acc; }.log-header { display: flex; justify-content: space-between; margin-bottom: 10px; }.log-title { color: #007acc; font-weight: bold; }.btn-copy { background: #007acc; color: white; border: none; padding: 5px 15px; border-radius: 3px; cursor: pointer; }.log-panel pre { margin: 0; font-family: monospace; font-size: 11px; white-space: pre-wrap; line-height: 1.4; }.header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }.footer { padding: 15px; }.btn { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; }</style></head><body><div class="log-panel"><div class="log-header"><span class="log-title">üìã Live Log</span><button class="btn-copy" onclick="copyLogs()">Copy</button></div><pre id="log"></pre></div><div class="header"><h2>üéØ Select Fields to Cache</h2></div><div id="categories"></div><div class="footer"><span id="count">Loading...</span><button class="btn" onclick="save()">Continue ‚Üí</button></div><script>var logEl = document.getElementById("log");var logs = [];function log(msg) {  var t = new Date().toISOString().substr(11, 8);  logs.push("[" + t + "] " + msg);  logEl.textContent = logs.join("\
");  logEl.scrollTop = logEl.scrollHeight;}function copyLogs() {  navigator.clipboard.writeText(logs.join("\
")).then(function() {    alert("‚úÖ Copied!");  });}function save() {  log("üíæ Saving...");}setTimeout(function() {  log("üéØ Client JavaScript started");  log("üìû Calling server getFieldSelectorData()...");  google.script.run.withSuccessHandler(function(data) {  log("‚úÖ Server responded!");  if (data.logs) {    log("üìã Server logs:");    for (var i = 0; i < data.logs.length; i++) {      log("   " + data.logs[i]);    }  }  if (data.error) {    log("‚ùå Server error: " + data.error);  } else {    log("‚úÖ Got " + Object.keys(data.grouped).length + " categories");    log("‚úÖ Got " + data.selected.length + " selected fields");    log("‚úÖ Got " + data.recommended.length + " recommended fields");    log("üìã Rendering fields...");    renderFields(data);  }}).withFailureHandler(function(err) {  log("‚ùå CLIENT ERROR: " + err.message);}).getFieldSelectorData();function renderFields(data) {  log("üé® Rendering fields in 3 sections...");  var container = document.getElementById("categories");  container.innerHTML = "";  var selectedFieldsList = [];  var recommendedFieldsList = [];  var otherFieldsList = [];  Object.keys(data.grouped).forEach(function(category) {    data.grouped[category].forEach(function(field) {      var isSelected = data.selected.indexOf(field.name) !== -1;      var isRecommended = data.recommended.indexOf(field.name) !== -1;      if (isSelected) {        selectedFieldsList.push(field);      } else if (isRecommended) {        recommendedFieldsList.push(field);      } else {        otherFieldsList.push(field);      }    });  });  log("   ‚úÖ Section 1: " + selectedFieldsList.length + " selected");  log("   üí° Section 2: " + recommendedFieldsList.length + " recommended");  log("   üìã Section 3: " + otherFieldsList.length + " other");  if (selectedFieldsList.length > 0) {    var section1Header = document.createElement("div");    section1Header.className = "section-header section-selected";    section1Header.innerHTML = "‚úÖ SELECTED FIELDS (" + selectedFieldsList.length + ") - Default or Previously Saved";    container.appendChild(section1Header);    selectedFieldsList.forEach(function(field) {      var fieldDiv = document.createElement("div");      fieldDiv.className = "field-item field-item-compact";      var checkbox = document.createElement("input");      checkbox.type = "checkbox";      checkbox.id = field.name;      checkbox.checked = true;      checkbox.onchange = updateCount;      var label = document.createElement("label");      label.htmlFor = field.name;      label.innerHTML = "<span class=\\"field-name\\">" + field.name + "</span>";      fieldDiv.appendChild(checkbox);      fieldDiv.appendChild(label);      container.appendChild(fieldDiv);    });  }  if (recommendedFieldsList.length > 0) {    var section2Header = document.createElement("div");    section2Header.className = "section-header section-recommended";    section2Header.innerHTML = "üí° AI RECOMMENDED TO CONSIDER (" + recommendedFieldsList.length + ")<div class=\\"ai-rationale\\">AI suggests these fields would maximize pathway discovery by revealing clinical reasoning patterns, grouping similar cases, and identifying time-critical scenarios.</div>";    container.appendChild(section2Header);    recommendedFieldsList.forEach(function(field) {      var fieldDiv = document.createElement("div");      fieldDiv.className = "field-item field-item-compact";      var checkbox = document.createElement("input");      checkbox.type = "checkbox";      checkbox.id = field.name;      checkbox.checked = false;      checkbox.onchange = updateCount;      var label = document.createElement("label");      label.htmlFor = field.name;      label.innerHTML = "<span class=\\"field-name\\">" + field.name + "</span>";      fieldDiv.appendChild(checkbox);      fieldDiv.appendChild(label);      container.appendChild(fieldDiv);    });  }  if (otherFieldsList.length > 0) {    var section3Header = document.createElement("div");    section3Header.className = "section-header section-other";    section3Header.textContent = "üìã ALL OTHER AVAILABLE FIELDS (" + otherFieldsList.length + ")";    container.appendChild(section3Header);    var categorized = {};    otherFieldsList.forEach(function(field) {      if (!categorized[field.tier1]) categorized[field.tier1] = [];      categorized[field.tier1].push(field);    });    Object.keys(categorized).forEach(function(category) {      var catDiv = document.createElement("div");      catDiv.className = "category";      var catHeader = document.createElement("div");      catHeader.className = "category-header";      catHeader.innerHTML = "<div><span class=\\"category-title\\">" + category + "</span><span class=\\"category-count\\">(" + categorized[category].length + ")</span></div>";      catDiv.appendChild(catHeader);      categorized[category].forEach(function(field) {        var fieldDiv = document.createElement("div");        fieldDiv.className = "field-item";        var checkbox = document.createElement("input");        checkbox.type = "checkbox";        checkbox.id = field.name;        checkbox.checked = false;        checkbox.onchange = updateCount;        var label = document.createElement("label");        label.htmlFor = field.name;        label.innerHTML = "<span class=\\"field-name\\">" + field.name + "</span>";        fieldDiv.appendChild(checkbox);        fieldDiv.appendChild(label);        catDiv.appendChild(fieldDiv);      });      container.appendChild(catDiv);    });  }  log("‚úÖ Rendered all fields in 3 sections");  updateCount();}function updateCount() {  var count = 0;  document.querySelectorAll("input[type=checkbox]:checked").forEach(function() { count++; });  document.getElementById("count").textContent = "Selected: " + count + " fields";}function resetToDefaults() {  location.reload();}function continueToCache() {  var selected = [];  document.querySelectorAll("input[type=checkbox]:checked").forEach(function(cb) { selected.push(cb.id); });  log("üíæ Saving " + selected.length + " fields...");  google.script.run.withSuccessHandler(function() {    log("‚úÖ Saved! Starting cache...");    google.script.host.close();  }).withFailureHandler(function(err) {    log("‚ùå Save error: " + err.message);    alert("Error: " + err.message);  }).saveFieldSelectionAndStartCache(selected);}}, 100);<\/script></body></html>